<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src 'self' ws://localhost:3001 wss://localhost:3001 wss://discord-clone-ws.onrender.com wss://*; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; img-src 'self' data: blob:">
  <title>MrDomestos*</title>
  <link rel="icon" type="image/svg+xml" href="icon.svg">
  <link rel="stylesheet" href="styles.css?v=2">
  <style>
    /* Force larger avatars in voice view */
    .voice-user .avatar {
      width: 120px !important;
      height: 120px !important;
      font-size: 48px !important;
      border: 4px solid transparent !important;
      box-shadow: 0 8px 40px rgba(168, 85, 247, 0.4) !important;
    }
    .voice-user .avatar.speaking {
      box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.4), 0 0 40px rgba(34, 197, 94, 0.6) !important;
    }
    .voice-user span {
      font-size: 16px !important;
      color: var(--text-primary) !important;
    }
    .voice-users {
      gap: 60px !important;
    }
    @keyframes speaking-pulse {
      from { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.3), 0 0 30px rgba(34, 197, 94, 0.5) !important; }
      to { box-shadow: 0 0 0 8px rgba(34, 197, 94, 0.5), 0 0 50px rgba(34, 197, 94, 0.7) !important; }
    }
  </style>
</head>
<body class="theme-dark">
  <!-- Custom Title Bar -->
  <div class="titlebar">
    <div class="titlebar-drag">
      <span class="titlebar-title">✦ MrDomestos</span>
    </div>
    <div class="titlebar-controls">
      <button class="titlebar-btn" id="minimize-btn">
        <svg viewBox="0 0 12 12"><rect y="5" width="12" height="2" rx="1"/></svg>
      </button>
      <button class="titlebar-btn" id="maximize-btn">
        <svg viewBox="0 0 12 12"><rect x="1" y="1" width="10" height="10" rx="2" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>
      </button>
      <button class="titlebar-btn close" id="close-btn">
        <svg viewBox="0 0 12 12"><path d="M2 2l8 8M10 2L2 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
      </button>
    </div>
  </div>

  <div class="version-badge">beta</div>
  
  <div class="app hidden" id="main-app">
    <!-- Servers Sidebar -->
    <nav class="servers" id="servers-list">
      <div class="server-btn home-btn active" data-view="home" title="Главная">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      </div>
      <div class="server-divider"></div>
      <div class="server-btn add-server" id="add-server-btn" title="Создать сервер">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </div>
      <div class="server-btn join-server" id="join-server-btn" title="Присоединиться">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
      </div>
    </nav>

    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-view home-view active" id="home-view">
        <div class="sidebar-header"><h2>✦ MrDomestos</h2></div>
        <div class="sidebar-nav">
          <button class="nav-btn active" id="friends-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            Друзья
          </button>
        </div>
        <div class="sidebar-section">
          <div class="section-title">Личные сообщения</div>
          <div id="dm-list"></div>
        </div>
      </div>

      <div class="sidebar-view server-view" id="server-view">
        <div class="sidebar-header server-header">
          <h2 id="server-name">Сервер</h2>
          <button class="icon-btn" id="server-menu-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
          </button>
        </div>
        <div class="sidebar-section">
          <div class="categories-header">
            <span>Каналы</span>
            <button class="add-btn" id="add-category-btn" title="Создать категорию"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
          </div>
          <div id="categories-list">
            <div class="channel-category" data-category-id="text">
              <div class="category-header">
                <svg class="category-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                <span>Текстовые каналы</span>
                <button class="add-btn" id="add-channel-btn" title="Создать канал"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
              </div>
              <div id="channel-list" class="category-channels"></div>
            </div>
            <div class="channel-category" data-category-id="voice">
              <div class="category-header">
                <svg class="category-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                <span>Голосовые каналы</span>
                <button class="add-btn" id="add-voice-btn" title="Создать канал"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
              </div>
              <div id="voice-list" class="category-channels"></div>
            </div>
          </div>
          <div id="custom-categories"></div>
        </div>
      </div>

      <!-- User Panel -->
      <div class="user-panel">
        <div class="user-avatar" id="user-avatar"></div>
        <div class="user-info">
          <div class="user-name" id="user-name">Гость</div>
          <div class="user-status" id="user-status">В сети</div>
        </div>
        <div class="user-controls">
          <button id="mic-toggle" title="Микрофон"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg></button>
          <button id="sound-toggle" title="Звук"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg></button>
          <button id="settings-btn" title="Настройки"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <!-- Friends View -->
      <div class="main-view active" id="friends-view">
        <div class="main-header">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          <span>Друзья</span>
          <div class="tabs">
            <button class="tab active" data-tab="online">В сети</button>
            <button class="tab" data-tab="all">Все</button>
            <button class="tab" data-tab="pending">Ожидание <span class="pending-count" id="pending-count"></span></button>
            <button class="tab accent" data-tab="add">Добавить</button>
          </div>
        </div>
        <div class="main-content">
          <div class="tab-content active" id="tab-online"><div id="online-users"></div></div>
          <div class="tab-content" id="tab-all"><div id="all-users"></div></div>
          <div class="tab-content" id="tab-pending"><div id="pending-users"></div></div>
          <div class="tab-content" id="tab-add">
            <div class="add-form">
              <h3>Добавить в друзья</h3>
              <p>Найдите пользователя по имени</p>
              <div class="input-row">
                <input type="text" id="search-input" placeholder="Имя пользователя">
                <button class="btn primary" id="search-btn">Найти</button>
              </div>
              <div id="search-results"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat View -->
      <div class="main-view" id="chat-view">
        <div class="main-header">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          <span id="channel-name">общий</span>
          <span class="typing" id="typing"></span>
          <div class="header-actions">
            <button class="icon-btn" id="search-channel-btn" title="Поиск"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></button>
          </div>
        </div>
        <div class="messages" id="messages"></div>
        <div class="reply-bar" id="reply-bar">
          <div class="reply-info">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 14 4 9 9 4"/><path d="M20 20v-7a4 4 0 0 0-4-4H4"/></svg>
            <span>Ответ для <strong class="reply-name"></strong></span>
            <span class="reply-text"></span>
          </div>
          <button class="reply-close" id="reply-close">&times;</button>
        </div>
        <div class="message-input">
          <button class="icon-btn" id="attach-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg></button>
          <input type="file" id="file-input" hidden>
          <input type="text" id="msg-input" placeholder="Написать сообщение...">
          <button class="icon-btn" id="send-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button>
        </div>
      </div>

      <!-- DM View -->
      <div class="main-view" id="dm-view">
        <div class="main-header dm-header">
          <div class="dm-user">
            <div class="avatar small" id="dm-header-avatar"></div>
            <span id="dm-header-name">Пользователь</span>
          </div>
          <div class="dm-header-actions">
            <button class="icon-btn" id="dm-call-btn" title="Начать звонок">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
            </button>
            <button class="icon-btn" id="dm-video-btn" title="Видеозвонок">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
            </button>
          </div>
        </div>
        <div class="dm-content">
          <div class="dm-profile">
            <div class="dm-profile-avatar" id="dm-avatar"></div>
            <h2 class="dm-profile-name" id="dm-name">Пользователь</h2>
            <p class="dm-profile-hint">Это начало истории ваших личных сообщений.</p>
          </div>
          <div class="messages" id="dm-messages"></div>
        </div>
        <div class="message-input">
          <button class="icon-btn" id="dm-attach-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg></button>
          <input type="file" id="dm-file-input" hidden>
          <input type="text" id="dm-input" placeholder="Написать сообщение...">
          <button class="icon-btn" id="dm-send-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button>
        </div>
      </div>

      <!-- Voice View -->
      <div class="main-view" id="voice-view">
        <div class="voice-header">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
          <span id="voice-name">Голосовой канал</span>
        </div>
        <div class="voice-room">
          <div class="voice-users" id="voice-users"></div>
        </div>
        <div class="voice-toolbar">
          <div class="voice-toolbar-group">
            <button class="voice-tool-btn" id="voice-mic" title="Микрофон">
              <svg class="mic-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
              <svg class="mic-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;"><line x1="1" y1="1" x2="23" y2="23"/><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"/><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
            </button>
            <button class="voice-tool-btn dropdown" id="voice-mic-settings">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
            </button>
            <button class="voice-tool-btn" id="voice-video" title="Видео">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
            </button>
            <button class="voice-tool-btn dropdown" id="voice-video-settings">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
            </button>
          </div>
          <div class="voice-toolbar-group">
            <button class="voice-tool-btn" id="voice-noise" title="Шумоподавление">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3l18 18M12 2v8m0 4v8M8 6v12M16 6v12M4 10v4M20 10v4"/></svg>
            </button>
            <button class="voice-tool-btn" id="voice-screen" title="Демонстрация экрана">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
            </button>
          </div>
          <button class="voice-leave-btn" id="voice-leave" title="Отключиться">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/><line x1="23" y1="1" x2="1" y2="23"/></svg>
          </button>
        </div>
      </div>
    </main>

    <!-- Members Panel -->
    <aside class="members" id="members-panel">
      <div id="members-online"></div>
      <div id="members-offline"></div>
    </aside>
  </div>

  <!-- Context Menus -->
  <div class="context-menu" id="server-context">
    <button data-action="invite"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>Пригласить</button>
    <button data-action="settings"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>Настройки</button>
    <div class="divider"></div>
    <button data-action="leave" class="danger"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>Покинуть</button>
  </div>

  <!-- Channel Context Menu -->
  <div class="context-menu" id="channel-context">
    <button data-action="edit-channel"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>Редактировать канал</button>
    <button data-action="clone-channel"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Клонировать канал</button>
    <div class="divider"></div>
    <button data-action="delete-channel" class="danger"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>Удалить канал</button>
  </div>

  <!-- Category Context Menu -->
  <div class="context-menu" id="category-context">
    <button data-action="create-channel"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Создать канал</button>
    <button data-action="edit-category"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>Редактировать категорию</button>
  </div>

  <!-- Message Context Menu -->
  <div class="context-menu message-context" id="message-context">
    <button data-action="reply"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 14 4 9 9 4"/><path d="M20 20v-7a4 4 0 0 0-4-4H4"/></svg>Ответить</button>
    <button data-action="forward"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 14 20 9 15 4"/><path d="M4 20v-7a4 4 0 0 1 4-4h12"/></svg>Переслать</button>
    <div class="divider"></div>
    <button data-action="copy-text"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Копировать текст</button>
    <div class="divider"></div>
    <button data-action="delete-message" class="danger"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>Удалить сообщение</button>
  </div>

  <!-- Voice User Context Menu -->
  <div class="context-menu" id="voice-user-context">
    <button data-action="send-dm"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>Написать в личные сообщения</button>
    <button data-action="add-friend"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>Добавить в друзья</button>
  </div>

  <!-- Member Context Menu -->
  <div class="context-menu" id="member-context">
    <button data-action="view-profile"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>Посмотреть профиль</button>
    <button data-action="send-dm"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>Написать сообщение</button>
    <button data-action="voice-call"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>Позвонить</button>
    <button data-action="add-friend"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>Добавить в друзья</button>
    <div class="divider"></div>
    <button data-action="kick-member" class="danger admin-only"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="18" y1="8" x2="23" y2="13"/><line x1="23" y1="8" x2="18" y2="13"/></svg>Исключить с сервера</button>
    <button data-action="ban-member" class="danger admin-only"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>Забанить</button>
  </div>

  <!-- Self Context Menu (for yourself on server) -->
  <div class="context-menu modern" id="self-context">
    <button data-action="view-profile"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>Профиль</span></button>
    <button data-action="mention-self"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94"/></svg><span>Упомянуть</span></button>
    <div class="divider"></div>
    <button data-action="mute-self" class="has-toggle"><span>Заглушить</span><div class="ctx-toggle" id="ctx-mute-toggle"></div></button>
    <button data-action="deafen-self" class="has-toggle"><span>Откл. звук</span><div class="ctx-toggle" id="ctx-deafen-toggle"></div></button>
    <div class="divider"></div>
    <button data-action="edit-server-profile"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg><span>Редактировать личный профиль сервера</span></button>
    <button data-action="view-roles" class="has-submenu"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Роли</span><svg class="submenu-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>
    <div class="divider"></div>
    <button data-action="copy-user-id"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>Копировать ID пользователя</span><span class="ctx-badge">ID</span></button>
  </div>

  <!-- Member Context Menu with Roles -->
  <div class="context-menu modern" id="member-context-full">
    <button data-action="view-profile"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>Профиль</span></button>
    <button data-action="mention"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94"/></svg><span>Упомянуть</span></button>
    <button data-action="send-dm"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span>Написать сообщение</span></button>
    <div class="divider"></div>
    <button data-action="mute-member" class="has-toggle admin-action"><span>Заглушить</span><div class="ctx-toggle" id="ctx-member-mute"></div></button>
    <button data-action="deafen-member" class="has-toggle admin-action"><span>Откл. звук</span><div class="ctx-toggle" id="ctx-member-deafen"></div></button>
    <div class="divider"></div>
    <button data-action="edit-server-profile-member" class="admin-action"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg><span>Редактировать профиль участника</span></button>
    <button data-action="manage-roles" class="has-submenu admin-action"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Роли</span><svg class="submenu-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>
    <div class="divider admin-divider"></div>
    <button data-action="kick-member" class="danger admin-action"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="18" y1="8" x2="23" y2="13"/><line x1="23" y1="8" x2="18" y2="13"/></svg><span>Исключить с сервера</span></button>
    <button data-action="ban-member" class="danger admin-action"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg><span>Забанить</span></button>
    <div class="divider"></div>
    <button data-action="copy-user-id"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><span>Копировать ID пользователя</span><span class="ctx-badge">ID</span></button>
  </div>

  <!-- Roles Submenu -->
  <div class="context-menu modern submenu" id="roles-submenu">
    <div class="submenu-header">Роли</div>
    <div class="roles-submenu-list" id="roles-submenu-list"></div>
  </div>

  <!-- DM Call Modal -->
  <div class="modal" id="dm-call-modal">
    <div class="modal-content dm-call-modal">
      <div class="dm-call-container">
        <div class="dm-call-user">
          <div class="dm-call-avatar" id="dm-call-avatar">?</div>
          <div class="dm-call-name" id="dm-call-name">Пользователь</div>
          <div class="dm-call-status" id="dm-call-status">Вызов...</div>
        </div>
        <div class="dm-call-video-container" id="dm-call-video-container">
          <video id="dm-remote-video" autoplay playsinline></video>
          <video id="dm-local-video" autoplay playsinline muted></video>
        </div>
        <div class="dm-call-controls">
          <button class="dm-call-btn" id="dm-call-mic" title="Микрофон">
            <svg class="mic-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
            <svg class="mic-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><line x1="1" y1="1" x2="23" y2="23"/><path d="M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"/><path d="M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
          </button>
          <button class="dm-call-btn" id="dm-call-video-toggle" title="Видео">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
          </button>
          <button class="dm-call-btn end-call" id="dm-call-end" title="Завершить">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/><line x1="23" y1="1" x2="1" y2="23"/></svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Incoming Call Modal -->
  <div class="modal" id="incoming-call-modal">
    <div class="modal-content incoming-call-modal">
      <div class="incoming-call-container">
        <div class="incoming-call-avatar" id="incoming-call-avatar">?</div>
        <div class="incoming-call-name" id="incoming-call-name">Пользователь</div>
        <div class="incoming-call-text">Входящий звонок...</div>
        <div class="incoming-call-actions">
          <button class="incoming-call-btn accept" id="accept-call-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
            Принять
          </button>
          <button class="incoming-call-btn decline" id="decline-call-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/><line x1="23" y1="1" x2="1" y2="23"/></svg>
            Отклонить
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- User Profile Modal -->
  <div class="modal" id="user-profile-modal">
    <div class="modal-content user-profile-modal">
      <div class="profile-banner"></div>
      <div class="profile-header">
        <div class="profile-avatar-wrapper">
          <div class="profile-avatar" id="profile-avatar">?</div>
          <div class="profile-status-badge" id="profile-status-badge"></div>
        </div>
        <div class="profile-actions">
          <button class="profile-action-btn" id="profile-dm-btn" title="Написать сообщение">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          </button>
          <button class="profile-action-btn" id="profile-call-btn" title="Позвонить">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
          </button>
          <button class="profile-action-btn" id="profile-friend-btn" title="Добавить в друзья">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
          </button>
        </div>
      </div>
      <div class="profile-body">
        <h2 class="profile-name" id="profile-name">Username</h2>
        <p class="profile-custom-status" id="profile-custom-status"></p>
        <div class="profile-section" id="profile-roles-section" style="display:none;">
          <h3>Роли</h3>
          <div class="profile-roles" id="profile-roles"></div>
        </div>
        <div class="profile-section">
          <h3>О пользователе</h3>
          <div class="profile-info">
            <div class="profile-info-item">
              <span class="label">Статус</span>
              <span class="value" id="profile-status-text">В сети</span>
            </div>
            <div class="profile-info-item">
              <span class="label">Зарегистрирован</span>
              <span class="value" id="profile-created">—</span>
            </div>
          </div>
        </div>
        <div class="profile-section" id="profile-mutual-section">
          <h3>Общие серверы</h3>
          <div class="profile-mutual-servers" id="profile-mutual-servers"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Auth Screen -->
  <div class="auth-screen active" id="auth-screen">
    <div class="auth-bg">
      <div class="planet planet-1"></div>
      <div class="planet planet-2"></div>
      <div class="stars"></div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="auth-loading" id="auth-loading">
      <div class="loading-logo">
        <svg viewBox="0 0 100 100">
          <defs>
            <linearGradient id="logo-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#7289da"/>
              <stop offset="100%" style="stop-color:#5865f2"/>
            </linearGradient>
          </defs>
          <circle cx="50" cy="50" r="45" fill="url(#logo-gradient)"/>
          <text x="50" y="65" text-anchor="middle" fill="white" font-size="40" font-weight="bold" font-family="Arial">M</text>
        </svg>
      </div>
      <div class="loading-text">
        <h2>MrDomestos</h2>
        <p>Подготавливаем всё для вас...</p>
      </div>
      <div class="loading-progress">
        <div class="loading-progress-bar"></div>
      </div>
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="loading-tips">Совет: Используйте Ctrl+K для быстрого поиска</div>
    </div>
    
    <div class="auth-container">
      <div class="auth-box" id="login-box">
        <h1>Добро пожаловать</h1>
        <p class="auth-subtitle">Войдите в свой аккаунт MrDomestos</p>
        <div class="auth-form">
          <div class="auth-field">
            <input type="email" id="login-email" placeholder="Email" required>
          </div>
          <div class="auth-field password-field">
            <input type="password" id="login-pass" placeholder="Пароль" required>
            <button type="button" class="show-pass" id="show-login-pass">Показать</button>
          </div>
          <a href="#" class="forgot-link">Забыли пароль?</a>
          <button class="auth-btn" id="login-btn">Войти</button>
          <div class="auth-divider"><span>или</span></div>
          <button class="auth-btn secondary" id="guest-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
            Войти как гость
          </button>
        </div>
        <p class="auth-footer">Нет аккаунта? <a href="#" id="show-register">Создать</a></p>
        <p class="error" id="login-error"></p>
      </div>
      
      <div class="auth-box hidden" id="register-box">
        <h1>Создать аккаунт</h1>
        <p class="auth-subtitle">Присоединяйтесь к MrDomestos</p>
        <div class="auth-form">
          <div class="auth-field">
            <input type="text" id="reg-name" placeholder="Имя пользователя" required>
          </div>
          <div class="auth-field">
            <input type="email" id="reg-email" placeholder="Email" required>
          </div>
          <div class="auth-field password-field">
            <input type="password" id="reg-pass" placeholder="Пароль" required>
            <button type="button" class="show-pass" id="show-reg-pass">Показать</button>
          </div>
          <button class="auth-btn" id="reg-btn">Создать аккаунт</button>
        </div>
        <p class="auth-footer">Уже есть аккаунт? <a href="#" id="show-login">Войти</a></p>
        <p class="error" id="reg-error"></p>
      </div>
    </div>
  </div>

  <div class="modal" id="settings-modal">
    <div class="modal-box large">
      <div class="modal-header"><h2>Настройки</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="settings-layout">
        <div class="settings-nav">
          <button class="settings-tab active" data-settings="profile">Профиль</button>
          <button class="settings-tab" data-settings="audio">Голос и видео</button>
        </div>
        <div class="settings-content">
          <div class="settings-panel active" id="settings-profile">
            <h3>Профиль</h3>
            <div class="avatar-edit">
              <div class="avatar large" id="settings-avatar"></div>
              <div class="avatar-actions">
                <button class="btn" id="upload-avatar">Загрузить</button>
                <button class="btn secondary" id="remove-avatar">Удалить</button>
              </div>
              <input type="file" id="avatar-input" accept="image/*" style="display:none">
            </div>
            <div class="form-group"><label>Имя пользователя</label><input type="text" id="settings-name"></div>
            <button class="btn primary" id="save-profile">Сохранить</button>
            <div class="signout-section">
              <button class="btn danger" id="signout-btn">Выйти из аккаунта</button>
            </div>
          </div>
          <div class="settings-panel" id="settings-audio">
            <h3>Голос и видео</h3>
            <div class="form-group">
              <label>Устройство ввода</label>
              <div class="custom-select" id="mic-select-wrapper">
                <div class="custom-select-trigger" id="mic-select-trigger">
                  <span>Выберите микрофон</span>
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                </div>
                <div class="custom-select-options" id="mic-select-options"></div>
              </div>
              <input type="hidden" id="mic-select">
            </div>
            <div class="form-group">
              <label>Устройство вывода</label>
              <div class="custom-select" id="speaker-select-wrapper">
                <div class="custom-select-trigger" id="speaker-select-trigger">
                  <span>Выберите динамик</span>
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                </div>
                <div class="custom-select-options" id="speaker-select-options"></div>
              </div>
              <input type="hidden" id="speaker-select">
            </div>
            <div class="form-group">
              <label>Громкость микрофона</label>
              <input type="range" id="mic-volume" min="0" max="100" value="100">
            </div>
            <div class="form-group mic-test-section">
              <label>Проверка микрофона</label>
              <p class="hint">Нажмите кнопку и говорите — вы услышите себя в наушниках</p>
              <div class="mic-test-row">
                <button class="btn primary" id="mic-test-btn">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/></svg>
                  <span>Проверить микрофон</span>
                </button>
                <div class="mic-level-container">
                  <div class="mic-level-bar" id="mic-level-bar"></div>
                </div>
              </div>
            </div>
            <button class="btn primary" id="save-audio">Сохранить</button>
          </div>

        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="create-server-modal">
    <div class="modal-box">
      <div class="modal-header"><h2>Создать сервер</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="modal-content">
        <div class="avatar-edit center">
          <div class="avatar large" id="new-server-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></div>
          <button class="btn" id="upload-server-icon">Загрузить иконку</button>
          <input type="file" id="server-icon-input" accept="image/*" hidden>
        </div>
        <div class="form-group"><label>Название сервера</label><input type="text" id="new-server-name" placeholder="Мой сервер"></div>
        <button class="btn primary full" id="create-server-btn">Создать</button>
      </div>
    </div>
  </div>

  <div class="modal" id="join-modal">
    <div class="modal-box">
      <div class="modal-header"><h2>Присоединиться</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="modal-content">
        <div class="form-group"><label>Код приглашения</label><input type="text" id="invite-code" placeholder="Введите код"></div>
        <button class="btn primary full" id="use-invite-btn">Присоединиться</button>
        <p class="error" id="invite-error"></p>
      </div>
    </div>
  </div>

  <div class="modal" id="invite-modal">
    <div class="modal-box">
      <div class="modal-header"><h2>Пригласить</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="modal-content">
        <p>Отправьте этот код другу:</p>
        <div class="invite-code-box">
          <input type="text" id="invite-code-display" readonly>
          <button class="btn" id="copy-invite">Копировать</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="channel-modal">
    <div class="modal-box">
      <div class="modal-header"><h2>Создать канал</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="modal-content">
        <div class="form-group"><label>Название канала</label><input type="text" id="new-channel-name" placeholder="новый-канал"></div>
        <button class="btn primary full" id="create-channel-btn">Создать</button>
      </div>
    </div>
  </div>

  <!-- Create Category Modal -->
  <div class="modal" id="category-modal">
    <div class="modal-box">
      <div class="modal-header"><h2>Создать категорию</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="modal-content">
        <div class="form-group">
          <label>Название категории</label>
          <input type="text" id="new-category-name" placeholder="Новая категория">
        </div>
        <button class="btn primary full" id="create-category-btn">Создать</button>
      </div>
    </div>
  </div>

  <!-- Server Settings Modal -->
  <div class="modal" id="server-settings-modal">
    <div class="modal-box xlarge">
      <div class="modal-header"><h2>Настройки сервера</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="settings-layout server-settings-layout">
        <div class="settings-nav">
          <div class="settings-nav-section">
            <div class="settings-nav-title">Сервер</div>
            <button class="settings-tab active" data-server-settings="profile">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg>
              Профиль сервера
            </button>
            <button class="settings-tab" data-server-settings="reactions">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
              Реакции
            </button>
            <button class="settings-tab" data-server-settings="emoji">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
              Эмодзи
            </button>
            <button class="settings-tab" data-server-settings="stickers">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z"/><path d="M15 3v6h6"/></svg>
              Стикеры
            </button>
          </div>
          <div class="settings-nav-divider"></div>
          <div class="settings-nav-section">
            <div class="settings-nav-title">Управление</div>
            <button class="settings-tab" data-server-settings="people">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              Люди
            </button>

            <button class="settings-tab" data-server-settings="roles">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
              Роли
            </button>
            <button class="settings-tab" data-server-settings="invites">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
              Приглашения
            </button>
            <button class="settings-tab" data-server-settings="audit">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
              Журнал аудита
            </button>
            <button class="settings-tab" data-server-settings="bans">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>
              Баны
            </button>
          </div>
          <div class="settings-nav-divider"></div>
          <button class="settings-tab danger-tab" data-server-settings="danger">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
            Удалить сервер
          </button>
        </div>
        <div class="settings-content">
          <!-- Профиль сервера -->
          <div class="settings-panel active" id="server-settings-profile">
            <h3>Профиль сервера</h3>
            <p class="settings-hint">Настройте внешний вид и основную информацию о вашем сервере.</p>
            <div class="server-profile-section">
              <div class="avatar-edit center">
                <div class="avatar large server-avatar" id="edit-server-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                  <div class="avatar-overlay">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                    <span>Изменить</span>
                  </div>
                </div>
                <button class="btn" id="change-server-icon">Загрузить иконку</button>
                <button class="btn secondary" id="remove-server-icon">Удалить</button>
                <input type="file" id="edit-server-icon-input" accept="image/*" hidden>
              </div>
              <div class="form-group">
                <label>Название сервера</label>
                <input type="text" id="edit-server-name" placeholder="Название сервера">
                <span class="form-hint">Это имя будет отображаться в списке серверов</span>
              </div>
              <div class="form-group">
                <label>Описание сервера</label>
                <textarea id="edit-server-description" placeholder="Расскажите о вашем сервере..." rows="3"></textarea>
                <span class="form-hint">Краткое описание для новых участников</span>
              </div>
              <div class="form-group">
                <label>Приватность сервера</label>
                <div class="privacy-options">
                  <label class="radio-option">
                    <input type="radio" name="server-privacy" value="public" checked>
                    <div class="radio-content">
                      <span class="radio-title">Публичный</span>
                      <span class="radio-desc">Любой может найти и присоединиться</span>
                    </div>
                  </label>
                  <label class="radio-option">
                    <input type="radio" name="server-privacy" value="private">
                    <div class="radio-content">
                      <span class="radio-title">Приватный</span>
                      <span class="radio-desc">Только по приглашению</span>
                    </div>
                  </label>
                </div>
              </div>
              <button class="btn primary" id="save-server-settings">Сохранить изменения</button>
            </div>
          </div>

          <!-- Реакции -->
          <div class="settings-panel" id="server-settings-reactions">
            <h3>Реакции</h3>
            <p class="settings-hint">Настройте реакции, доступные на вашем сервере.</p>
            <div class="reactions-section">
              <div class="section-header">
                <h4>Стандартные реакции</h4>
                <p class="section-desc">Выберите реакции, которые будут доступны по умолчанию</p>
              </div>
              <div class="default-reactions-grid" id="default-reactions-grid">
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="👍" checked><span class="emoji">👍</span></label>
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="👎" checked><span class="emoji">👎</span></label>
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="❤️" checked><span class="emoji">❤️</span></label>
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="😂" checked><span class="emoji">😂</span></label>
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="😮" checked><span class="emoji">😮</span></label>
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="😢" checked><span class="emoji">😢</span></label>
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="😡" checked><span class="emoji">😡</span></label>
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="🎉" checked><span class="emoji">🎉</span></label>
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="🔥" checked><span class="emoji">🔥</span></label>
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="💯" checked><span class="emoji">💯</span></label>
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="✅" checked><span class="emoji">✅</span></label>
                <label class="reaction-checkbox"><input type="checkbox" data-emoji="❌" checked><span class="emoji">❌</span></label>
              </div>
              <div class="section-header" style="margin-top: 24px;">
                <h4>Пользовательские реакции</h4>
                <p class="section-desc">Загрузите собственные изображения для реакций</p>
              </div>
              <div class="custom-reactions-list" id="custom-reactions-list">
                <div class="empty-state small">Пользовательские реакции не добавлены</div>
              </div>
              <div class="upload-area" id="reaction-upload-area">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                <span>Перетащите изображение или нажмите для загрузки</span>
                <input type="file" id="reaction-upload-input" accept="image/*" hidden>
              </div>
              <button class="btn primary" id="save-reactions-settings">Сохранить настройки</button>
            </div>
          </div>

          <!-- Эмодзи -->
          <div class="settings-panel" id="server-settings-emoji">
            <h3>Эмодзи сервера</h3>
            <p class="settings-hint">Загрузите пользовательские эмодзи для использования на сервере.</p>
            <div class="emoji-section">
              <div class="emoji-stats">
                <div class="stat-item">
                  <span class="stat-value" id="emoji-count">0</span>
                  <span class="stat-label">/ 50 эмодзи</span>
                </div>
              </div>
              <div class="emoji-list" id="server-emoji-list">
                <div class="empty-state-fancy">
                  <div class="empty-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
                  </div>
                  <h4>Эмодзи пока нет</h4>
                  <p>Загрузите первый эмодзи, чтобы сделать общение ярче!</p>
                </div>
              </div>
              <div class="upload-area" id="emoji-upload-area">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                <span>Загрузить эмодзи (PNG, JPG, GIF до 256KB)</span>
                <input type="file" id="emoji-upload-input" accept="image/png,image/jpeg,image/gif" hidden>
              </div>
              <div class="emoji-requirements">
                <h5>Требования к эмодзи:</h5>
                <ul>
                  <li>Размер: 128x128 пикселей (рекомендуется)</li>
                  <li>Формат: PNG, JPG или GIF</li>
                  <li>Максимальный размер файла: 256KB</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Стикеры -->
          <div class="settings-panel" id="server-settings-stickers">
            <h3>Стикеры</h3>
            <p class="settings-hint">Создавайте и управляйте стикерами вашего сервера.</p>
            <div class="stickers-section">
              <div class="stickers-stats">
                <div class="stat-item">
                  <span class="stat-value" id="sticker-count">0</span>
                  <span class="stat-label">/ 15 стикеров</span>
                </div>
              </div>
              <div class="stickers-categories">
                <button class="category-btn active" data-category="all">Все</button>
                <button class="category-btn" data-category="memes">Мемы</button>
                <button class="category-btn" data-category="emotions">Эмоции</button>
                <button class="category-btn" data-category="custom">Другое</button>
              </div>
              <div class="stickers-grid" id="server-stickers-grid">
                <div class="empty-state-fancy">
                  <div class="empty-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                  </div>
                  <h4>Стикеров пока нет</h4>
                  <p>Добавьте стикеры для более выразительного общения!</p>
                </div>
              </div>
              <div class="upload-area" id="sticker-upload-area">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                <span>Загрузить стикер (PNG до 512KB, 320x320px)</span>
                <input type="file" id="sticker-upload-input" accept="image/png" hidden>
              </div>
            </div>
          </div>

          <!-- Люди -->
          <div class="settings-panel" id="server-settings-people">
            <h3>Люди</h3>
            <p class="settings-hint">Обзор всех участников сервера.</p>
            <div class="people-section">
              <div class="people-stats">
                <div class="stat-card">
                  <span class="stat-value" id="total-members-count">0</span>
                  <span class="stat-label">Всего участников</span>
                </div>
                <div class="stat-card">
                  <span class="stat-value online" id="online-members-count">0</span>
                  <span class="stat-label">В сети</span>
                </div>
                <div class="stat-card">
                  <span class="stat-value" id="new-members-count">0</span>
                  <span class="stat-label">Новых за неделю</span>
                </div>
              </div>
              <div class="people-filters">
                <input type="text" id="people-search" placeholder="Поиск по имени...">
                <select id="people-role-filter">
                  <option value="all">Все роли</option>
                </select>
                <select id="people-status-filter">
                  <option value="all">Все статусы</option>
                  <option value="online">В сети</option>
                  <option value="offline">Не в сети</option>
                </select>
              </div>
              <div class="people-list" id="people-list">
                <div class="empty-state">Загрузка участников...</div>
              </div>
            </div>
          </div>



          <!-- Роли -->
          <div class="settings-panel" id="server-settings-roles">
            <h3>Роли сервера</h3>
            <p class="settings-hint">Создавайте роли и настраивайте права доступа для участников.</p>
            <div class="roles-section">
              <div class="roles-header">
                <button class="btn-compact primary" id="create-role-btn">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                  Создать
                </button>
              </div>
              <div class="roles-info">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                <span>Роли с более высокой позицией имеют приоритет. Перетащите для изменения порядка.</span>
              </div>
              <div class="roles-list" id="roles-list"></div>
            </div>
          </div>

          <!-- Приглашения -->
          <div class="settings-panel" id="server-settings-invites">
            <h3>Приглашения</h3>
            <p class="settings-hint">Управляйте ссылками приглашений на сервер.</p>
            <div class="invites-section">
              <div class="invites-header">
                <button class="btn-compact primary" id="create-invite-btn">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                  Создать
                </button>
              </div>
              <div class="invites-list" id="invites-list">
                <div class="empty-state">Активных приглашений нет</div>
              </div>
            </div>
          </div>

          <!-- Журнал аудита -->
          <div class="settings-panel" id="server-settings-audit">
            <h3>Журнал аудита</h3>
            <p class="settings-hint">История всех действий на сервере.</p>
            <div class="audit-section">
              <div class="audit-filters">
                <select id="audit-action-filter">
                  <option value="all">Все действия</option>
                  <option value="member_join">Вступление</option>
                  <option value="member_leave">Выход</option>
                  <option value="member_kick">Исключение</option>
                  <option value="member_ban">Бан</option>
                  <option value="role_create">Создание роли</option>
                  <option value="role_update">Изменение роли</option>
                  <option value="channel_create">Создание канала</option>
                  <option value="channel_delete">Удаление канала</option>
                  <option value="server_update">Изменение сервера</option>
                </select>
                <select id="audit-user-filter">
                  <option value="all">Все пользователи</option>
                </select>
              </div>
              <div class="audit-log" id="audit-log">
                <div class="empty-state">Журнал аудита пуст</div>
              </div>
            </div>
          </div>

          <!-- Баны -->
          <div class="settings-panel" id="server-settings-bans">
            <h3>Забаненные пользователи</h3>
            <p class="settings-hint">Управляйте списком заблокированных пользователей.</p>
            <div class="bans-section">
              <div class="bans-search">
                <input type="text" id="bans-search-input" placeholder="Поиск по имени...">
              </div>
              <div class="bans-list" id="bans-list">
                <div class="empty-state">Нет забаненных пользователей</div>
              </div>
            </div>
          </div>

          <!-- Удаление сервера -->
          <div class="settings-panel" id="server-settings-danger">
            <h3>Опасная зона</h3>
            <p class="settings-hint danger-hint">Эти действия необратимы. Будьте осторожны.</p>
            <div class="danger-zone">
              <div class="danger-item">
                <div class="danger-info">
                  <h4>Передать владение</h4>
                  <p>Передайте права владельца другому участнику сервера.</p>
                </div>
                <button class="btn danger-outline" id="transfer-ownership-btn">Передать</button>
              </div>
              <div class="danger-item">
                <div class="danger-info">
                  <h4>Удалить сервер</h4>
                  <p>Это действие нельзя отменить. Все каналы, сообщения и данные будут удалены навсегда.</p>
                </div>
                <button class="btn danger" id="delete-server-btn">Удалить сервер</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirm Delete Modal -->
  <div class="modal" id="confirm-delete-modal">
    <div class="modal-box">
      <div class="modal-header"><h2>Удалить сервер?</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="modal-content">
        <p class="warning-text">Вы уверены, что хотите удалить сервер <strong id="delete-server-name"></strong>?</p>
        <p class="warning-text">Это действие нельзя отменить!</p>
        <div class="form-group"><label>Введите название сервера для подтверждения</label><input type="text" id="confirm-server-name" placeholder="Название сервера"></div>
        <div class="btn-row">
          <button class="btn secondary" data-close>Отмена</button>
          <button class="btn danger" id="confirm-delete-btn" disabled>Удалить</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirm Delete Channel Modal -->
  <div class="modal" id="confirm-delete-channel-modal">
    <div class="modal-box">
      <div class="modal-header"><h2>Удалить канал</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="modal-content">
        <p class="warning-text">Вы уверены, что хотите удалить канал <strong id="delete-channel-name"></strong>?</p>
        <p class="warning-text">Все сообщения будут удалены безвозвратно.</p>
        <div class="btn-row">
          <button class="btn secondary" data-close>Отмена</button>
          <button class="btn danger" id="confirm-delete-channel-btn">Удалить</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Forward Message Modal -->
  <div class="modal" id="forward-modal">
    <div class="modal-box">
      <div class="modal-header"><h2>Переслать сообщение</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="modal-content">
        <div class="forward-preview">
          <div class="forward-msg" id="forward-msg-preview"></div>
        </div>
        <div class="form-group">
          <label>Выберите куда переслать</label>
          <div class="forward-list" id="forward-list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Channel Modal -->
  <div class="modal" id="edit-channel-modal">
    <div class="modal-box xlarge">
      <div class="modal-header"><h2 id="channel-modal-title">Настройки канала</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="role-modal-layout">
        <div class="role-modal-nav">
          <button class="channel-tab active" data-channel-tab="overview">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            Обзор
          </button>
          <button class="channel-tab" data-channel-tab="permissions">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            Права доступа
          </button>
          <div class="nav-divider"></div>
          <button class="channel-tab danger-tab" id="delete-channel-from-settings">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
            Удалить канал
          </button>
        </div>
        <div class="role-modal-content">
          <!-- Обзор -->
          <div class="channel-panel active" id="channel-panel-overview">
            <h3>Обзор канала</h3>
            <p class="settings-hint">Основные настройки канала.</p>
            
            <div class="form-group">
              <label>Название канала</label>
              <input type="text" id="edit-channel-name" placeholder="название-канала">
              <span class="form-hint">Используйте только буквы, цифры и дефисы</span>
            </div>
            
            <div class="form-group">
              <label>Описание канала</label>
              <textarea id="edit-channel-topic" placeholder="О чём этот канал?" rows="3"></textarea>
              <span class="form-hint">Описание отображается в заголовке канала</span>
            </div>
            
            <div class="form-group" id="slowmode-group">
              <label>Медленный режим</label>
              <select id="edit-channel-slowmode">
                <option value="0">Выключен</option>
                <option value="5">5 секунд</option>
                <option value="10">10 секунд</option>
                <option value="30">30 секунд</option>
                <option value="60">1 минута</option>
                <option value="300">5 минут</option>
              </select>
              <span class="form-hint">Ограничивает частоту отправки сообщений</span>
            </div>
          </div>
          
          <!-- Права доступа -->
          <div class="channel-panel" id="channel-panel-permissions">
            <h3>Права доступа</h3>
            <p class="settings-hint">Настройте права для ролей в этом канале.</p>
            
            <div class="channel-permissions-roles">
              <div class="permissions-role-selector">
                <label>Выберите роль</label>
                <select id="channel-perm-role-select">
                  <option value="everyone">@everyone</option>
                </select>
              </div>
            </div>
            
            <!-- Текстовые права (показываются для текстовых каналов) -->
            <div class="permission-category" id="text-channel-perms">
              <div class="permission-category-header">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                <span>Текстовые права</span>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Просмотр канала</span>
                  <span class="permission-desc">Возможность видеть этот канал</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-view" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Отправка сообщений</span>
                  <span class="permission-desc">Возможность писать сообщения</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-send" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Управление сообщениями</span>
                  <span class="permission-desc">Удаление и закрепление сообщений</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-manage-messages">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Прикрепление файлов</span>
                  <span class="permission-desc">Отправка изображений и файлов</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-attach" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Добавление реакций</span>
                  <span class="permission-desc">Возможность ставить реакции</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-reactions" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Упоминание @everyone</span>
                  <span class="permission-desc">Упоминание всех участников</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-mention-everyone">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
            
            <!-- Голосовые права (показываются для голосовых каналов) -->
            <div class="permission-category" id="voice-channel-perms" style="display: none;">
              <div class="permission-category-header">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/></svg>
                <span>Голосовые права</span>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Подключение</span>
                  <span class="permission-desc">Возможность присоединяться к каналу</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-connect" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Говорить</span>
                  <span class="permission-desc">Возможность говорить в канале</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-speak" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Видео</span>
                  <span class="permission-desc">Возможность включать камеру</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-video" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Демонстрация экрана</span>
                  <span class="permission-desc">Возможность транслировать экран</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-stream" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Отключать микрофон</span>
                  <span class="permission-desc">Отключать микрофон другим участникам</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-mute-members">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Отключать звук</span>
                  <span class="permission-desc">Отключать звук другим участникам</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-deafen-members">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Перемещать участников</span>
                  <span class="permission-desc">Перемещать между каналами</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="ch-perm-move-members">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="role-modal-footer">
          <button class="btn secondary" data-close>Отмена</button>
          <button class="btn primary" id="save-channel-settings">Сохранить</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Role Edit Modal -->
  <div class="modal" id="role-modal">
    <div class="modal-box xlarge">
      <div class="modal-header"><h2 id="role-modal-title">Создать роль</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="role-modal-layout">
        <div class="role-modal-nav">
          <button class="role-tab active" data-role-tab="general">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            Основные
          </button>
          <button class="role-tab" data-role-tab="permissions">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            Права доступа
          </button>
        </div>
        <div class="role-modal-content">
          <!-- Основные настройки -->
          <div class="role-panel active" id="role-panel-general">
            <h3>Основные настройки</h3>
            <p class="settings-hint">Настройте внешний вид роли на сервере.</p>
            
            <div class="form-group">
              <label>Название роли</label>
              <input type="text" id="role-name-input" placeholder="Например: Модератор">
              <span class="form-hint">Введите желаемое название для роли</span>
            </div>
            
            <div class="form-group">
              <label>Цвет роли</label>
              <div class="color-picker-extended">
                <div class="color-presets">
                  <button class="color-preset" data-color="#99aab5" style="background:#99aab5" title="Серый"></button>
                  <button class="color-preset" data-color="#1abc9c" style="background:#1abc9c" title="Бирюзовый"></button>
                  <button class="color-preset" data-color="#2ecc71" style="background:#2ecc71" title="Зелёный"></button>
                  <button class="color-preset" data-color="#3498db" style="background:#3498db" title="Синий"></button>
                  <button class="color-preset" data-color="#9b59b6" style="background:#9b59b6" title="Фиолетовый"></button>
                  <button class="color-preset" data-color="#e91e63" style="background:#e91e63" title="Розовый"></button>
                  <button class="color-preset" data-color="#f1c40f" style="background:#f1c40f" title="Жёлтый"></button>
                  <button class="color-preset" data-color="#e67e22" style="background:#e67e22" title="Оранжевый"></button>
                  <button class="color-preset" data-color="#e74c3c" style="background:#e74c3c" title="Красный"></button>
                  <button class="color-preset" data-color="#95a5a6" style="background:#95a5a6" title="Светло-серый"></button>
                </div>
                <div class="color-custom">
                  <input type="color" id="role-color-input" value="#99aab5">
                  <input type="text" id="role-color-hex" value="#99aab5" placeholder="#HEX">
                  <span id="role-color-preview" style="background: #99aab5"></span>
                </div>
              </div>
              <span class="form-hint">Цвет будет отображаться у имени участников с этой ролью</span>
            </div>
            
            <div class="form-group">
              <label>Иконка роли (опционально)</label>
              <div class="role-icon-upload">
                <div class="role-icon-preview" id="role-icon-preview">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                </div>
                <div class="role-icon-info">
                  <button class="btn-compact" id="upload-role-icon">Загрузить изображение</button>
                  <span class="form-hint">JPG или PNG, до 256 КБ, 64x64 px рекомендуется</span>
                </div>
                <input type="file" id="role-icon-input" accept="image/png,image/jpeg" hidden>
              </div>
            </div>
            
            <div class="form-group">
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Отображать роль отдельно</span>
                  <span class="permission-desc">Участники с этой ролью будут показаны в отдельной группе в списке участников</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="role-hoist">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
            
            <div class="form-group">
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Разрешить упоминание роли</span>
                  <span class="permission-desc">Любой участник сможет упомянуть эту роль через @</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="role-mentionable">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>
          
          <!-- Права доступа -->
          <div class="role-panel" id="role-panel-permissions">
            <h3>Общие права доступа</h3>
            <p class="settings-hint">Настройте базовые разрешения для этой роли.</p>
            
            <div class="permission-category">
              <div class="permission-category-header">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                <span>Общие разрешения</span>
              </div>
              
              <div class="permission-row danger-perm">
                <div class="permission-info">
                  <span class="permission-name">Администратор</span>
                  <span class="permission-desc">Полный доступ ко всем функциям сервера. Используйте с осторожностью!</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="perm-admin">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Управление ролями</span>
                  <span class="permission-desc">Создание, редактирование и удаление ролей ниже по иерархии</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="perm-manage-roles">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Управление каналами</span>
                  <span class="permission-desc">Создание, редактирование и удаление каналов</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="perm-manage-channels">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Исключение участников</span>
                  <span class="permission-desc">Возможность кикать участников с сервера</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="perm-kick">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Бан участников</span>
                  <span class="permission-desc">Возможность банить участников на сервере</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="perm-ban">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="permission-row">
                <div class="permission-info">
                  <span class="permission-name">Управление сервером</span>
                  <span class="permission-desc">Изменение названия, иконки и настроек сервера</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="perm-manage-server">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="role-modal-footer">
          <button class="btn secondary" data-close>Отмена</button>
          <button class="btn primary" id="save-role-btn">Сохранить роль</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Member Actions Modal -->
  <div class="modal" id="member-modal">
    <div class="modal-box">
      <div class="modal-header"><h2>Управление участником</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="modal-content">
        <div class="member-profile">
          <div class="avatar large" id="member-modal-avatar"></div>
          <div class="member-modal-name" id="member-modal-name">Участник</div>
        </div>
        <div class="form-group">
          <label>Назначить роль</label>
          <select id="member-role-select" class="form-select"></select>
        </div>
        <div class="btn-row">
          <button class="btn secondary" data-close>Закрыть</button>
          <button class="btn primary" id="assign-role-btn">Назначить роль</button>
        </div>
        <div class="member-actions-danger">
          <button class="btn danger-outline" id="kick-member-btn">Исключить</button>
          <button class="btn danger" id="ban-member-btn">Забанить</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Modal -->
  <div class="modal" id="search-modal">
    <div class="modal-box large">
      <div class="modal-header"><h2>Поиск</h2><button class="close-btn" data-close>&times;</button></div>
      <div class="modal-content">
        <div class="search-input-row">
          <input type="text" id="global-search-input" placeholder="Поиск сообщений...">
          <button class="btn primary" id="global-search-btn">Найти</button>
        </div>
        <div class="search-results" id="global-search-results"></div>
      </div>
    </div>
  </div>

  <!-- Emoji Picker -->
  <div class="emoji-picker" id="emoji-picker">
    <div class="emoji-grid">
      <button class="emoji-btn" data-emoji="👍">👍</button>
      <button class="emoji-btn" data-emoji="👎">👎</button>
      <button class="emoji-btn" data-emoji="❤️">❤️</button>
      <button class="emoji-btn" data-emoji="😂">😂</button>
      <button class="emoji-btn" data-emoji="😮">😮</button>
      <button class="emoji-btn" data-emoji="😢">😢</button>
      <button class="emoji-btn" data-emoji="😡">😡</button>
      <button class="emoji-btn" data-emoji="🎉">🎉</button>
      <button class="emoji-btn" data-emoji="🔥">🔥</button>
      <button class="emoji-btn" data-emoji="💯">💯</button>
      <button class="emoji-btn" data-emoji="✅">✅</button>
      <button class="emoji-btn" data-emoji="❌">❌</button>
    </div>
  </div>

  <!-- Voice Settings Dropdown -->
  <div class="voice-dropdown" id="voice-mic-dropdown">
    <div class="voice-dropdown-header">Устройство ввода</div>
    <select id="voice-input-device" class="voice-device-select"></select>
    <div class="voice-dropdown-header">Громкость микрофона</div>
    <input type="range" id="voice-input-volume" min="0" max="100" value="100" class="voice-slider">
    <div class="voice-volume-indicator">
      <div class="voice-volume-bar" id="voice-volume-bar"></div>
    </div>
    <div class="voice-dropdown-header">Шумоподавление</div>
    <label class="voice-toggle">
      <input type="checkbox" id="voice-noise-toggle" checked>
      <span class="voice-toggle-slider"></span>
      <span class="voice-toggle-label">Включено</span>
    </label>
    <button class="btn small" id="voice-test-mic">Проверить микрофон</button>
  </div>

  <script src="app.js"></script>
</body>
</html>
